#!/bin/bash
. /var/openpanel/api/sh/module.sh

WordpressAdmin.update() {
  appid=wordpress
  newpass=$(coreval WordpressAdmin password)
  if [ ! -z ${newpass} ]; then
    MD5_PWD=$(echo -n ${newpass} | md5sum | cut -f 1 -d ' ')
    authd runscript openapp-call "$appid" passwd "MD5|$MD5_PWD"
  fi

  siteurl=$(coreval WordpressAdmin site_url)
  [ -z ${siteurl} ] || authd runscript openapp-call "$appid" siteurl "$siteurl"
}

Module.getconfig() {
  appid=wordpress
  SITEURL=$(authd runscript openapp-call "$appid" siteurl)

  cat << _EOF_
  <openpanel.module>
    <dict id="WordpressAdmin" type="class">
      <dict id="Admin">
	    <string id="password">*</string>
	    <string id="site_url">${SITEURL}</string>
      </dict>
    </dict>
  </openpanel.module>
_EOF_
  exitquiet
}

implement OpenAppWordpress.module
